<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grovance - Campus-Verified Marketplace | Growth Made Simple</title>
    <!-- Load Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL FIREBASE SETUP (Mandatory) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Make variables globally accessible within this module script
        window.firebaseApp = null;
        window.auth = null;
        window.db = null;
        window.currentUserId = null;
        window.isAuthReady = false;

        setLogLevel('Debug'); // Enable Firebase logging

        if (firebaseConfig) {
            window.firebaseApp = initializeApp(firebaseConfig);
            window.auth = getAuth(window.firebaseApp);
            window.db = getFirestore(window.firebaseApp);
            
            // 1. Initial Authentication & Setup
            onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    window.currentUserId = user.uid;
                } else {
                    try {
                        // Ensure we always have an auth state, even if anonymous, to satisfy security rules
                        if (initialAuthToken) {
                             await signInWithCustomToken(window.auth, initialAuthToken);
                        } else {
                             await signInAnonymously(window.auth);
                        }
                    } catch (error) {
                         console.error("Firebase sign-in failed:", error);
                    }
                    window.currentUserId = window.auth.currentUser?.uid || crypto.randomUUID();
                }
                
                window.isAuthReady = true;
                console.log("Auth Ready. User ID:", window.currentUserId);
                
                // If the app is already loaded, re-initialize views/data
                if (window.appLoaded) {
                    if (window.currentView === 'marketplace') {
                         setupMarketplaceListener();
                    }
                    updateAuthUI(user);
                }
            });

            // 2. Export necessary variables/functions to global scope for HTML functions
            window.appId = appId;
            window.db = window.db; 
        } else {
            console.error("Firebase configuration is missing. Running in simulation mode.");
        }
    </script>
    
    <style>
        /* Custom CSS for a clean, student-friendly look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* Light background */
            scroll-behavior: smooth;
        }
        .text-grovance {
            color: #3b82f6; /* Blue for primary branding */
        }
        .bg-grovance {
            background-color: #3b82f6;
        }
        .cta-button {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .section-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        /* Class to hide content blocks */
        .hidden-view {
            display: none;
        }
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        /* Custom style for active category link */
        .category-link {
            cursor: pointer;
            padding: 4px 0;
            transition: color 0.2s;
        }
        .category-link:hover {
            color: #3b82f6;
        }
        .category-link.active {
            font-weight: 700;
            color: #1d4ed8; /* Darker blue for active */
        }
    </style>
</head>
<body>

    <!-- Main Container to hold all views -->
    <div id="app-container">

        <!-- Navigation Bar (Shared for all views) -->
        <header class="sticky top-0 z-50 bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div class="text-2xl font-extrabold text-grovance tracking-tight cursor-pointer" onclick="switchView('home')">
                    GROVANCE
                </div>
                
                <!-- Main Navigation Links -->
                <nav class="hidden md:flex space-x-8 text-gray-600 font-medium">
                    <a href="#" class="nav-link hover:text-grovance transition" data-view="home" onclick="switchView('home')">Home</a>
                    <a href="#" class="nav-link hover:text-grovance transition" data-view="about" onclick="switchView('about')">About Us</a>
                    <a href="#" class="nav-link hover:text-grovance transition" data-view="partners" onclick="switchView('partners')">Partners</a>
                    <a href="#" class="nav-link hover:text-grovance transition" data-view="contact" onclick="switchView('contact')">Contact</a>
                </nav>
                
                <!-- Search bar visible on marketplace view -->
                <div class="w-1/2 hidden" id="marketplace-search-bar">
                    <input type="text" id="search-input" placeholder="Search books, electronics, furniture..."
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-grovance focus:border-grovance transition shadow-sm" />
                </div>

                <!-- Right Side Actions -->
                <div class="flex items-center space-x-4">
                    
                    <!-- Login/Logout Icon -->
                    <button id="auth-icon" class="text-gray-600 hover:text-grovance transition p-2 rounded-full hover:bg-gray-100" 
                            onclick="handleAuthClick()" title="Register / Sign Out">
                        <i class="fas fa-user-plus text-xl"></i>
                    </button>

                    <!-- Primary CTA Button (Contextual) -->
                    <button id="main-cta-btn" class="bg-grovance text-white px-5 py-2 rounded-full font-semibold cta-button" onclick="handleCtaClick()">
                        Join Now
                    </button>
                </div>
            </div>
            <div id="auth-status-bar" class="bg-yellow-100 text-yellow-800 text-sm text-center py-1 hidden">
                You are viewing as a guest. Please register with your college email for full access.
            </div>
        </header>

        <!-- ============================================== -->
        <!-- VIEW CONTAINERS -->
        <!-- ============================================== -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

            <!-- 1. Home Page (Landing Section) -->
            <div id="home-view" class="view">
                <section class="pt-10 pb-20 text-center">
                    <div class="max-w-4xl mx-auto">
                        <h1 class="text-4xl sm:text-6xl lg:text-7xl font-extrabold tracking-tight text-gray-900 leading-tight mb-6">
                            <span class="text-grovance">Stop Wasting Money</span> & Ditch the Scams.
                        </h1>
                        <p class="mt-3 max-w-2xl mx-auto text-xl text-gray-600 font-medium">
                            Campus-verified, safe, and sustainable platform for **affordable student essentials.**
                        </p>
                        <div class="mt-10 flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                            <input type="email" id="home-email-input" placeholder="Your University Email..."
                                   class="w-full sm:w-80 px-6 py-4 border border-gray-300 rounded-xl shadow-lg focus:ring-grovance focus:border-grovance transition" />
                            <button class="w-full sm:w-auto text-lg bg-grovance text-white px-8 py-4 rounded-xl font-bold cta-button" onclick="switchView('register')">
                                Register & Explore <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                        <p class="mt-4 text-sm text-gray-500">
                            **Growth Made Simple** — Start saving today.
                        </p>
                    </div>
                </section>

                <section class="py-20 bg-white section-card" id="problem">
                    <div class="text-center mb-16">
                        <span class="text-sm font-semibold text-grovance uppercase">Our Vision</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">A Safer, Smarter Campus Economy</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">Grovance solves the core problem: Students struggle to find a safe way to buy and sell second-hand goods on campus.</p>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="p-8 text-center transition">
                            <i class="fas fa-hand-holding-dollar text-5xl text-red-500 mb-4"></i>
                            <h3 class="xl font-bold text-gray-900 mb-3">Affordable Essentials</h3>
                            <p class="text-gray-600">Cut the cost of living by accessing peer-to-peer used textbooks, furniture, and electronics.</p>
                        </div>
                        <div class="p-8 text-center transition">
                            <i class="fas fa-lock text-5xl text-grovance mb-4"></i>
                            <h3 class="xl font-bold text-gray-900 mb-3">Campus-Verified Safety</h3>
                            <p class="text-gray-600">Eliminate scams and risk with a platform where every user is verified as a peer or senior.</p>
                        </div>
                        <div class="p-8 text-center transition">
                            <i class="fas fa-recycle text-5xl text-emerald-500 mb-4"></i>
                            <h3 class="xl font-bold text-gray-900 mb-3">Sustainability Drive</h3>
                            <p class="text-gray-600">Reduce waste and clutter by giving every item a second life within your university ecosystem.</p>
                        </div>
                    </div>
                </section>
                
                <!-- CTA Banner to Marketplace -->
                <div class="bg-grovance/90 text-white mt-16 p-12 rounded-3xl text-center">
                    <h3 class="text-3xl font-bold mb-4">Ready to Grow Your Savings?</h3>
                    <button class="text-lg bg-white text-grovance px-8 py-3 rounded-full font-bold cta-button" onclick="switchView('register')">
                        Start Registration <i class="fas fa-user-check ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- 2. About Page -->
            <div id="about-view" class="view hidden-view">
                <section class="py-10">
                    <h1 class="text-5xl font-extrabold text-gray-900 mb-8 border-b pb-4">About Grovance</h1>
                    <div class="grid md:grid-cols-3 gap-12">
                        <div class="md:col-span-2">
                            <h2 class="text-3xl font-bold text-grovance mb-4">Our Purpose & Vision</h2>
                            <p class="text-lg text-gray-700 mb-6">
                                **Grovance** is pioneering the transition to a circular, safe, and cost-effective student economy across India's college campuses. We were founded on the belief that securing essential study and living items shouldn't be expensive or risky. We are building the infrastructure for growth—financial, sustainable, and communal—for every student.
                            </p>
                            <h3 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">Value Proposition for Partners</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-600">
                                <li>**Risk Mitigation:** Offering a verified alternative to unregulated Facebook/WhatsApp groups.</li>
                                <li>**ESG Compliance:** Supporting university sustainability goals through reuse and waste reduction.</li>
                                <li>**Student Welfare:** Directly addressing student financial stress by promoting affordability.</li>
                            </ul>
                        </div>
                        <div class="section-card p-6">
                            <p class="text-sm font-semibold text-grovance">STATS FROM SURVEY</p>
                            <p class="text-4xl font-bold text-gray-900 mt-2 mb-1">56.7%</p>
                            <p class="text-gray-600">of students say a campus buy/sell platform is **Highly Needed**.</p>
                            <hr class="my-4">
                            <p class="text-4xl font-bold text-emerald-600 mb-1">4.16 / 5</p>
                            <p class="text-gray-600">is the average trust rating for a peer-to-peer system.</p>
                        </div>
                    </div>

                    <h2 class="text-4xl font-extrabold text-gray-900 mt-20 mb-10 border-b pb-4">Meet the Team</h2>
                    <div class="grid md:grid-cols-3 gap-8 text-center">
                        <div class="section-card p-8 hover:bg-gray-50 transition">
                            <i class="fas fa-user-tie text-5xl text-grovance mb-4"></i>
                            <h3 class="2xl font-bold text-gray-900">P Lokesh Sahitya</h3>
                            <p class="text-lg font-semibold text-gray-600">CEO (Chief Executive Officer)</p>
                            <p class="text-gray-500 mt-3">Drives the vision and strategy of Grovance, ensuring growth, partnerships, and overall execution.</p>
                        </div>
                        <div class="section-card p-8 hover:bg-gray-50 transition">
                            <i class="fas fa-chart-line text-5xl text-green-600 mb-4"></i>
                            <h3 class="2xl font-bold text-gray-900">S Suneet</h3>
                            <p class="text-lg font-semibold text-gray-600">CFO (Chief Financial Officer)</p>
                            <p class="text-gray-500 mt-3">Manages finances, revenue models, and ensures sustainable and profitable operations.</p>
                        </div>
                        <div class="section-card p-8 hover:bg-gray-50 transition">
                            <i class="fas fa-laptop-code text-5xl text-yellow-600 mb-4"></i>
                            <h3 class="2xl font-bold text-gray-900">N Trivikram</h3>
                            <p class="text-lg font-semibold text-gray-600">CTO (Chief Technology Officer)</p>
                            <p class="text-gray-500 mt-3">Leads platform development, ensuring a secure, reliable, and student-friendly tech experience.</p>
                        </div>
                    </div>
                </section>
            </div>

             <!-- 7. Registration Page (New View) -->
            <div id="register-view" class="view hidden-view">
                <section class="py-10 max-w-md mx-auto">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-4 border-b pb-4 text-center">Campus Verification</h1>
                    <p class="text-lg text-gray-600 mb-8 text-center">To ensure a safe and verified marketplace, you must register with your official **College Email ID**.</p>
                    
                    <form id="register-form" class="section-card p-8 space-y-6">
                        <div class="space-y-1">
                            <label for="reg-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input type="text" id="reg-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                        </div>
                        <div class="space-y-1">
                            <label for="reg-email" class="block text-sm font-medium text-gray-700">College Email ID</label>
                            <input type="email" id="reg-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance" placeholder="e.g., username@college.edu.in">
                            <p class="text-xs text-red-500">Only university domains accepted for verification.</p>
                        </div>
                        <div class="space-y-1">
                            <label for="reg-password" class="block text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="reg-password" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                        </div>
                        <button type="submit" class="w-full bg-grovance text-white py-3 rounded-xl font-bold cta-button hover:bg-grovance/90">
                            Register & Get Verified
                        </button>
                        <p class="text-center text-sm text-gray-500">Already registered? <a href="#" onclick="switchView('login')" class="text-grovance font-semibold hover:underline">Log In</a></p>
                    </form>
                </section>
            </div>

            <!-- 8. Login Page (New View) -->
             <div id="login-view" class="view hidden-view">
                 <section class="py-10 max-w-md mx-auto">
                     <h1 class="text-4xl font-extrabold text-gray-900 mb-4 border-b pb-4 text-center">Log In</h1>
                     <p class="text-lg text-gray-600 mb-8 text-center">Welcome back! Use your verified College Email ID to access the marketplace.</p>
                     
                     <form id="login-form" class="section-card p-8 space-y-6">
                         <div class="space-y-1">
                             <label for="login-email" class="block text-sm font-medium text-gray-700">College Email ID</label>
                             <input type="email" id="login-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance" placeholder="your@college.edu.in">
                         </div>
                         <div class="space-y-1">
                             <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                             <input type="password" id="login-password" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                         </div>
                         <button type="submit" class="w-full bg-grovance text-white py-3 rounded-xl font-bold cta-button hover:bg-grovance/90">
                             Log In
                         </button>
                         <p class="text-center text-sm text-gray-500">New user? <a href="#" onclick="switchView('register')" class="text-grovance font-semibold hover:underline">Register Here</a></p>
                     </form>
                 </section>
             </div>

            <!-- 3. Marketplace (Dynamic Prototype Page) -->
            <div id="marketplace-view" class="view hidden-view">
                <section class="pt-10 pb-16">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-8 border-b pb-4">Campus Marketplace</h1>

                    <div class="grid lg:grid-cols-4 gap-6">
                        <!-- Sidebar: Categories & Filters -->
                        <aside class="lg:col-span-1 p-6 section-card h-fit">
                            <h3 class="text-xl font-bold text-gray-900 mb-4 border-b pb-2">Categories</h3>
                            <ul class="space-y-3 text-gray-600" id="category-list">
                                <li class="category-link active" data-category="All" onclick="filterProducts('All', event)"><i class="fas fa-boxes-stacked mr-2"></i> View All</li>
                                <li class="category-link" data-category="Textbooks" onclick="filterProducts('Textbooks', event)"><i class="fas fa-book mr-2"></i> Textbooks & Notes</li>
                                <li class="category-link" data-category="Electronics" onclick="filterProducts('Electronics', event)"><i class="fas fa-desktop mr-2"></i> Electronics & Gadgets</li>
                                <li class="category-link" data-category="Furniture" onclick="filterProducts('Furniture', event)"><i class="fas fa-couch mr-2"></i> Furniture & Dorm Decor</li>
                                <li class="category-link" data-category="Project Items" onclick="filterProducts('Project Items', event)"><i class="fas fa-cogs mr-2"></i> Project Items (Pi/Arduino)</li>
                                <li class="category-link" data-category="Miscellaneous" onclick="filterProducts('Miscellaneous', event)"><i class="fas fa-box-open mr-2"></i> Miscellaneous</li>
                            </ul>

                            <h3 class="text-xl font-bold text-gray-900 mt-8 mb-4 border-b pb-2">Price Range (₹)</h3>
                            <p class="text-sm text-gray-500">Filters coming soon!</p>
                        </aside>

                        <!-- Main Content: Product Listings -->
                        <main class="lg:col-span-3">
                            <div class="flex justify-between items-center mb-6">
                                <p class="text-gray-600" id="item-count">Loading items...</p>
                                <select class="border rounded-lg p-2 text-sm">
                                    <option>Sort by: Most Recent</option>
                                    <option>Sort by: Price (Low to High)</option>
                                </select>
                            </div>

                            <!-- Product Grid (Amazon-like cards) - DYNAMICALLY POPULATED -->
                            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="product-grid">
                                <!-- Dynamic Product Cards will be injected here by JavaScript -->
                                <div class="col-span-full text-center py-10 text-gray-500 section-card" id="loading-message">
                                    <i class="fas fa-spinner fa-spin mr-2"></i> Loading marketplace data...
                                </div>
                            </div>
                        </main>
                    </div>
                </section>
            </div>

            <!-- 4. Post an Item Page -->
            <div id="post-item-view" class="view hidden-view">
                <section class="py-10 max-w-3xl mx-auto">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-4 border-b pb-4">Post Your Item (Sell or Exchange)</h1>
                    <p class="text-lg text-gray-600 mb-8">Fill in the details below to list your item instantly to verified peers on your campus.</p>

                    <form id="post-item-form" class="section-card p-8 space-y-6">
                         <p class="text-sm text-red-500 hidden" id="post-item-auth-warning">
                            <i class="fas fa-exclamation-triangle mr-2"></i> You must be logged in to post an item. Please register or log in first.
                        </p>
                        <div>
                            <label for="item-title" class="block text-sm font-medium text-gray-700">Item Title</label>
                            <input type="text" id="item-title" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="item-category" class="block text-sm font-medium text-gray-700">Category</label>
                                <select id="item-category" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance bg-white">
                                    <option value="">Select Category</option>
                                    <option value="Textbooks">Textbooks & Notes</option>
                                    <option value="Electronics">Electronics & Gadgets</option>
                                    <option value="Furniture">Furniture & Dorm Decor</option>
                                    <option value="Project Items">Project Items (Pi/Arduino)</option>
                                    <option value="Miscellaneous">Miscellaneous</option>
                                </select>
                            </div>
                            <div>
                                <label for="item-price" class="block text-sm font-medium text-gray-700">Price (₹)</label>
                                <input type="number" id="item-price" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance" placeholder="e.g., 850">
                            </div>
                        </div>
                        <div>
                            <label for="item-description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="item-description" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance" placeholder="Condition, location, usage history..."></textarea>
                        </div>
                        <div>
                            <label for="item-photo" class="block text-sm font-medium text-gray-700">Upload Photo (Simulated)</label>
                            <input type="file" id="item-photo" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-grovance/10 file:text-grovance hover:file:bg-grovance/20">
                            <p class="mt-1 text-xs text-gray-500">Max file size 2MB.</p>
                        </div>
                        <button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold cta-button hover:bg-emerald-700">
                            List Item Now
                        </button>
                    </form>
                </section>
            </div>

            <!-- 5. Partners & Ambassadors Page -->
            <div id="partners-view" class="view hidden-view">
                <section class="py-10">
                    <h1 class="text-5xl font-extrabold text-gray-900 mb-4 border-b pb-4">Partnerships & Campus Growth</h1>
                    <p class="text-xl text-gray-600 mb-12">We are actively building strategic relationships with universities, student clubs, and campus leaders to scale our mission of affordability and sustainability.</p>

                    <div class="grid md:grid-cols-2 gap-12">
                        <!-- University Partnerships -->
                        <div class="section-card p-8">
                            <i class="fas fa-university text-5xl text-grovance mb-4"></i>
                            <h2 class="text-3xl font-bold text-gray-900 mb-3">University Collaborations</h2>
                            <p class="text-gray-700 mb-4">We partner with administration to offer a verified, secure platform for intra-campus commerce, directly supporting student welfare and institutional sustainability goals (ESG initiatives).</p>
                            <h3 class="font-semibold text-gray-800 mt-4">Key Benefits:</h3>
                            <ul class="list-disc list-inside text-gray-600 ml-4">
                                <li>Formalized campus circular economy.</li>
                                <li>Reduction in disposal costs and waste volume.</li>
                                <li>Proof of commitment to student financial well-being.</li>
                            </ul>
                        </div>

                        <!-- Ambassador Program -->
                        <div class="section-card p-8">
                            <i class="fas fa-user-group text-5xl text-red-500 mb-4"></i>
                            <h2 class="text-3xl font-bold text-gray-900 mb-3">Campus Ambassador Program</h2>
                            <p class="text-gray-700 mb-4">Join the Grovance movement! We empower student leaders to be the face of our platform, manage campus outreach, and earn incentives.</p>
                            <h3 class="font-semibold text-gray-800 mt-4">What You Do:</h3>
                            <ul class="list-disc list-inside text-gray-600 ml-4">
                                <li>Campus outreach & marketing.</li>
                                <li>Organize on-campus exchange events.</li>
                                <li>Drive word-of-mouth adoption.</li>
                            </ul>
                            <button class="mt-6 bg-yellow-500 text-gray-900 py-2 px-6 rounded-full font-bold cta-button" onclick="switchView('contact')">
                                Apply to be an Ambassador
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 6. Contact Page -->
            <div id="contact-view" class="view hidden-view">
                <section class="py-10 max-w-xl mx-auto">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-4 border-b pb-4">Get in Touch</h1>
                    <p class="text-lg text-gray-600 mb-8">Whether you're a student with feedback, a university official, or an investor, we'd love to hear from you.</p>

                    <div class="section-card p-8 space-y-6">
                        <form id="contact-form" class="space-y-4">
                            <div>
                                <label for="contact-name" class="block text-sm font-medium text-gray-700">Your Name</label>
                                <input type="text" id="contact-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                            </div>
                            <div>
                                <label for="contact-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="contact-email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance">
                            </div>
                            <div>
                                <label for="contact-subject" class="block text-sm font-medium text-gray-700">Subject</label>
                                <select id="contact-subject" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance bg-white">
                                    <option value="">Select Topic</option>
                                    <option>Investment/Partnership Inquiry</option>
                                    <option>Campus Ambassador Application</option>
                                    <option>Technical Support</option>
                                    <option>General Feedback</option>
                                </select>
                            </div>
                            <div>
                                <label for="contact-message" class="block text-sm font-medium text-gray-700">Message</label>
                                <textarea id="contact-message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-grovance focus:border-grovance"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-grovance text-white py-3 rounded-xl font-bold cta-button hover:bg-grovance/90">
                                Send Message
                            </button>
                        </form>
                    </div>

                    <div class="mt-10 text-center">
                        <p class="text-xl font-semibold text-gray-900">Reach Our Team Directly:</p>
                        <p class="text-gray-600">Email: <a href="mailto:info@grovance.in" class="text-grovance hover:underline">info@grovance.in</a></p>
                        <p class="text-gray-600">Headquarters: Bengaluru, India</p>
                    </div>
                </section>
            </div>

            <!-- CTA for Posting Item (Visible on Marketplace) -->
            <button id="post-item-float-btn" class="fixed bottom-6 right-6 z-40 bg-emerald-600 text-white p-4 rounded-full shadow-2xl cta-button text-lg font-bold hidden" onclick="handlePostItemClick()">
                <i class="fas fa-plus mr-2"></i> Post Item
            </button>

        </main>
        <!-- Footer (Shared for all views) -->
        <footer class="py-12 bg-gray-900 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-4 gap-8">
                <!-- Logo/Motto -->
                <div>
                    <h3 class="text-2xl font-extrabold text-grovance mb-4">GROVANCE</h3>
                    <p class="text-gray-400">Growth Made Simple.</p>
                    <p class="text-sm text-gray-500 mt-2">&copy; 2025 Grovance. All rights reserved.</p>
                </div>
                <!-- Quick Links -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-white">Quick Links</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" onclick="switchView('about')" class="hover:text-grovance transition">Our Vision</a></li>
                        <li><a href="#" onclick="switchView('partners')" class="hover:text-grovance transition">Partnerships</a></li>
                        <li><a href="#" class="hover:text-grovance transition">Careers</a></li>
                    </ul>
                </div>
                <!-- The Team -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-white">The Leadership</h4>
                    <p class="text-gray-400">CEO: P Lokesh Sahitya</p>
                    <p class="text-gray-400">CFO: S Suneet</p>
                    <p class="text-gray-400">CTO: N Trivikram</p>
                </div>
                <!-- Social & Contact -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-white">Connect</h4>
                    <p class="text-gray-400">Connect with us on social media.</p>
                    <div class="flex space-x-4 mt-3">
                        <a href="#" class="text-gray-400 hover:text-grovance transition"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-grovance transition"><i class="fab fa-instagram"></i></a>
                        <a href="#" onclick="switchView('contact')" class="text-gray-400 hover:text-grovance transition"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. Product Data (Using stable placeholders for reliable loading) ---
        // This array is used for initial population if Firestore is empty. 
        // NOTE: Once items are added via the Post Item form, the marketplace will pull from Firestore instead.
        const ALL_PRODUCTS = [
            { id: 1, category: 'Textbooks', name: 'Discrete Mathematics and Its Applications (8th Ed.)', price: 700, listedBy: 'Jane D.', image: 'https://placehold.co/400x300/F4D03F/000?text=MATH+BOOK' },
            { id: 2, category: 'Electronics', name: 'HP 24-inch Monitor (Used for 1 semester)', price: 3500, listedBy: 'Mark K.', image: 'https://placehold.co/400x300/5DADE2/000?text=MONITOR' },
            { id: 3, category: 'Furniture', name: 'Adjustable LED Desk Lamp (Black)', price: 850, listedBy: 'Sofia R.', image: 'https://placehold.co/400x300/A9CCE3/000?text=DESK+LAMP' },
            { id: 4, category: 'Electronics', name: 'Ethernet Cable - 10ft CAT6', price: 150, listedBy: 'Ben A.', image: 'https://placehold.co/400x300/52BE80/000?text=CABLE' },
            { id: 5, category: 'Textbooks', name: 'An Introduction to the Philosophy of Law', price: 300, listedBy: 'Chloe P.', image: 'https://placehold.co/400x300/F1C40F/000?text=LAW+BOOK' },
            { id: 6, category: 'Project Items', name: 'Arduino Uno Ultimate Starter Kit', price: 1800, listedBy: 'Alex M.', image: 'https://placehold.co/400x300/D7BDE2/000?text=ARDUINO+KIT' },
            // --- NEW LISTINGS ---
            { id: 7, category: 'Furniture', name: 'Single Bed Mattress (6ft x 3ft, Clean)', price: 1200, listedBy: 'Priya S.', image: 'https://placehold.co/400x300/FF5733/fff?text=MATTRESS' },
            { id: 8, category: 'Project Items', name: 'Solderless Breadboard MB-102 (New)', price: 180, listedBy: 'Ravi T.', image: 'https://placehold.co/400x300/FFC300/333?text=BREADBOARD' },
            { id: 9, category: 'Furniture', name: 'Compact Folding Study Table', price: 950, listedBy: 'Kiran N.', image: 'https://placehold.co/400x300/DAF7A6/333?text=STUDY+TABLE' },
            { id: 10, category: 'Electronics', name: 'Adjustable DC Power Supply (0-30V)', price: 4200, listedBy: 'Nitin J.', image: 'https://placehold.co/400x300/4CAF50/fff?text=POWER+SUPPLY' },
        ];
        
        // --- 2. Element References & State ---
        let allProducts = []; // This will be populated by Firestore
        let currentView = 'home';
        let currentCategory = 'All';
        const views = {
            'home': document.getElementById('home-view'),
            'about': document.getElementById('about-view'),
            'marketplace': document.getElementById('marketplace-view'),
            'post-item': document.getElementById('post-item-view'),
            'partners': document.getElementById('partners-view'),
            'contact': document.getElementById('contact-view'),
            'register': document.getElementById('register-view'),
            'login': document.getElementById('login-view'),
        };
        const mainCtaButton = document.getElementById('main-cta-btn');
        const marketplaceSearchBar = document.getElementById('marketplace-search-bar');
        const productGrid = document.getElementById('product-grid');
        const itemCountDisplay = document.getElementById('item-count');
        const loadingMessage = document.getElementById('loading-message');
        const postItemForm = document.getElementById('post-item-form');
        const contactForm = document.getElementById('contact-form');
        const registerForm = document.getElementById('register-form');
        const loginForm = document.getElementById('login-form');
        const searchInput = document.getElementById('search-input');
        const postItemFloatBtn = document.getElementById('post-item-float-btn');
        const authIcon = document.getElementById('auth-icon');
        const postItemAuthWarning = document.getElementById('post-item-auth-warning');
        const authStatusBar = document.getElementById('auth-status-bar');
        
        // --- 2. Authentication UI Updates ---

        function updateAuthUI(user) {
            if (user && !user.isAnonymous) {
                // Logged In User
                authIcon.innerHTML = '<i class="fas fa-user-check text-xl text-green-600"></i>';
                authIcon.title = 'Sign Out';
                authIcon.onclick = handleSignOut;
                authStatusBar.classList.add('hidden');

            } else {
                // Anonymous or Not Logged In
                authIcon.innerHTML = '<i class="fas fa-user-plus text-xl"></i>';
                authIcon.title = 'Register / Sign In';
                authIcon.onclick = () => switchView('register');
                
                if (window.currentView === 'home' || window.currentView === 'marketplace') {
                     authStatusBar.classList.remove('hidden');
                }
            }
        }
        
        async function handleSignOut() {
            if (window.auth) {
                try {
                    await window.auth.signOut();
                    alertMessage("You have been signed out.");
                    switchView('home');
                } catch (error) {
                    alertMessage("Error signing out: " + error.message);
                }
            }
        }
        
        function handleAuthClick() {
            if (window.auth && window.auth.currentUser && !window.auth.currentUser.isAnonymous) {
                handleSignOut();
            } else {
                switchView('register');
            }
        }
        
        // --- 3. Database Listener (Firestore) ---

        let unsubscribeListings = null;

        function setupMarketplaceListener() {
            if (!window.db) {
                 console.warn("Database not ready. Using default local product data.");
                 allProducts = ALL_PRODUCTS; // Use hardcoded data if DB fails
                 loadingMessage.classList.add('hidden');
                 filterProducts(currentCategory);
                 return;
            }
            
            if (unsubscribeListings) return;
            
            loadingMessage.classList.remove('hidden');

            // Public Collection Path: /artifacts/{appId}/public/data/listings
            const listingsRef = collection(window.db, `artifacts/${window.appId}/public/data/listings`);
            const q = query(listingsRef); // OrderBy is avoided per instructions
            
            // Use exponential backoff for the snapshot listener
            let retryCount = 0;
            const maxRetries = 5;
            const baseDelay = 1000;

            const startListening = () => {
                unsubscribeListings = onSnapshot(q, (snapshot) => {
                    allProducts = [];
                    snapshot.forEach(doc => {
                        allProducts.push({ id: doc.id, ...doc.data() });
                    });

                    console.log("Fetched Products:", allProducts.length);
                    
                    // If Firestore is empty, initialize with default data for demonstration
                    if (allProducts.length === 0) {
                         allProducts = ALL_PRODUCTS;
                         console.log("Firestore empty, using hardcoded default products.");
                    }
                    
                    loadingMessage.classList.add('hidden');
                    filterProducts(currentCategory); // Re-render with new data
                    retryCount = 0; // Reset retry count on success
                }, (error) => {
                    console.error("Error fetching listings:", error);
                    unsubscribeListings(); // Stop current listener
                    
                    if (retryCount < maxRetries) {
                        const delay = baseDelay * Math.pow(2, retryCount);
                        retryCount++;
                        // Logging retries is suppressed per instructions
                        setTimeout(startListening, delay);
                    } else {
                        // Max retries reached, switch to hardcoded fallback
                        loadingMessage.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i> Error loading items. Using default data.`;
                        loadingMessage.classList.remove('hidden');
                        allProducts = ALL_PRODUCTS;
                        filterProducts(currentCategory);
                    }
                });
            };

            startListening();
        }
        
        // --- 4. Product Rendering and Filtering Logic ---
        
        function renderProductListings(productsToRender) {
            let htmlContent = '';
            
            itemCountDisplay.textContent = `Showing ${productsToRender.length} items`;
            
            if (productsToRender.length === 0 && allProducts.length > 0) {
                 htmlContent = `<div class="col-span-full text-center py-10 text-gray-500 section-card">No items found matching your current filters.</div>`;
            } else if (allProducts.length === 0 && !loadingMessage.classList.contains('hidden')) {
                 // Do nothing, let the loading message display
                 return;
            } else if (allProducts.length === 0 && loadingMessage.classList.contains('hidden')) {
                 htmlContent = `<div class="col-span-full text-center py-10 text-gray-500 section-card">Be the first to list an item!</div>`;
            } else {
                productsToRender.forEach(product => {
                    const formattedPrice = new Intl.NumberFormat('en-IN', {
                        style: 'currency',
                        currency: 'INR',
                        maximumFractionDigits: 0
                    }).format(product.price);

                    htmlContent += `
                        <div class="p-4 section-card overflow-hidden hover:shadow-lg transition duration-300 cursor-pointer">
                            <div class="h-48 bg-gray-200 rounded-xl mb-3 overflow-hidden">
                                <!-- Using placeholder image. User must replace the 'image' field in Firestore with a real URL or filename -->
                                <img src="${product.image || 'https://placehold.co/400x300/CCCCCC/333333?text=NO+IMAGE'}" alt="${product.name}" class="product-image" onerror="this.onerror=null;this.src='https://placehold.co/400x300/CCCCCC/333333?text=Image+Error';" />
                            </div>
                            <p class="text-sm text-grovance font-semibold mb-1">${product.category || 'Uncategorized'}</p>
                            <h4 class="font-bold text-gray-900 truncate">${product.name}</h4>
                            <p class="text-2xl font-extrabold text-green-600 my-2">${formattedPrice}</p>
                            <p class="text-sm text-gray-500">Listed by: ${product.listedBy || 'Anonymous'}</p>
                            <button class="mt-3 w-full bg-grovance text-white py-2 rounded-lg font-semibold hover:bg-grovance/90 transition">View Details</button>
                        </div>
                    `;
                });
            }

            productGrid.innerHTML = htmlContent;
        }
        
        function filterProducts(category, event) {
            if (event) {
                event.preventDefault();
                document.querySelectorAll('.category-link').forEach(link => link.classList.remove('active'));
                event.currentTarget.classList.add('active');
                if (searchInput) searchInput.value = '';
            }

            currentCategory = category;
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';

            const filteredProducts = allProducts.filter(product => {
                // Ensure product has category and name property for safe filtering
                const productCategory = product.category || '';
                const productName = product.name || '';
                
                const categoryMatch = currentCategory === 'All' || productCategory === currentCategory;
                const searchMatch = productName.toLowerCase().includes(searchTerm) || productCategory.toLowerCase().includes(searchTerm);
                
                return categoryMatch && searchMatch;
            });

            renderProductListings(filteredProducts);
        }

        // --- 5. View Switching Logic (Updated) ---

        function handleCtaClick() {
            // Main CTA redirects to register/login
            switchView('register');
        }
        
        function handlePostItemClick() {
             // Check if user is logged in (not anonymous)
             const user = window.auth?.currentUser;
             if (user && !user.isAnonymous) {
                 switchView('post-item');
             } else {
                 alertMessage("Please log in or register to post an item.");
                 switchView('register');
             }
         }

        function switchView(viewName) {
            currentView = viewName;

            // Stop listening to listings if leaving marketplace
            if (unsubscribeListings && viewName !== 'marketplace') {
                 unsubscribeListings();
                 unsubscribeListings = null;
            }

            // Hide all views, then show the current one
            Object.keys(views).forEach(key => views[key].classList.add('hidden-view'));
            if(views[viewName]) {
                 views[viewName].classList.remove('hidden-view');
            }

            // --- Contextual UI Updates ---
            const user = window.auth?.currentUser;
            
            // Post Item Warning Visibility
            if (viewName === 'post-item') {
                 if (user && user.email) {
                    postItemAuthWarning.classList.add('hidden');
                 } else {
                    postItemAuthWarning.classList.remove('hidden');
                 }
            }
            
            // Auth Status Bar Visibility
            if (user && user.isAnonymous) {
                if (viewName === 'home' || viewName === 'marketplace') {
                    authStatusBar.classList.remove('hidden');
                } else {
                    authStatusBar.classList.add('hidden');
                }
            } else {
                authStatusBar.classList.add('hidden');
            }
            
            // Navbar CTA Button Logic
            if (viewName === 'marketplace') {
                mainCtaButton.innerHTML = '<i class="fas fa-plus mr-2"></i> List Item';
                mainCtaButton.onclick = handlePostItemClick;
                postItemFloatBtn.classList.remove('hidden');
                
            } else if (viewName === 'register' || viewName === 'login') {
                 mainCtaButton.innerHTML = 'Register';
                 mainCtaButton.onclick = () => switchView('register');
                 postItemFloatBtn.classList.add('hidden');
            } else {
                mainCtaButton.innerHTML = 'Join Now';
                mainCtaButton.onclick = () => switchView('register');
                postItemFloatBtn.classList.add('hidden');
            }
            
            // Search Bar Visibility
            if (viewName === 'marketplace') {
                marketplaceSearchBar.classList.remove('hidden');
            } else {
                marketplaceSearchBar.classList.add('hidden');
            }

            // --- Marketplace Initialization ---
            if (viewName === 'marketplace') {
                if (window.isAuthReady) {
                    setupMarketplaceListener();
                    // Initial filter is needed here if data is already loaded, otherwise listener handles it
                    filterProducts('All'); 
                }
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // --- 6. Form Submission Handlers (Real Firebase Logic) ---
        function setupFormHandlers() {
            // Function to handle retries for API calls
            const callApiWithBackoff = async (apiCall, maxRetries = 5, baseDelay = 1000) => {
                let retryCount = 0;
                while (retryCount < maxRetries) {
                    try {
                        return await apiCall();
                    } catch (error) {
                        if (retryCount === maxRetries - 1) throw error;
                        const delay = baseDelay * Math.pow(2, retryCount);
                        retryCount++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            };
            
            if (registerForm) {
                 registerForm.addEventListener('submit', async (e) => {
                     e.preventDefault();
                     const email = document.getElementById('reg-email').value;
                     const password = document.getElementById('reg-password').value;

                     if (!email.includes('@') || password.length < 6) {
                         alertMessage("Password must be at least 6 characters and email must be valid.");
                         return;
                     }
                     
                     if (!window.auth) {
                         alertMessage("Firebase is not configured. Cannot register in this environment.");
                         return;
                     }
                     
                     try {
                         await callApiWithBackoff(() => createUserWithEmailAndPassword(window.auth, email, password));
                         alertMessage(`Success! Welcome ${email}. You are now verified.`);
                         registerForm.reset();
                         switchView('marketplace');
                     } catch (error) {
                         console.error("Registration Error:", error);
                         alertMessage(`Registration failed: ${error.message}`);
                     }
                 });
             }
             
             if (loginForm) {
                 loginForm.addEventListener('submit', async (e) => {
                     e.preventDefault();
                     const email = document.getElementById('login-email').value;
                     const password = document.getElementById('login-password').value;
                     
                     if (!window.auth) {
                         alertMessage("Firebase is not configured. Cannot log in in this environment.");
                         return;
                     }

                     try {
                         await callApiWithBackoff(() => signInWithEmailAndPassword(window.auth, email, password));
                         alertMessage("Login successful!");
                         loginForm.reset();
                         switchView('marketplace');
                     } catch (error) {
                         console.error("Login Error:", error);
                         alertMessage(`Login failed: Invalid credentials or account error.`);
                     }
                 });
             }

            if (postItemForm) {
                postItemForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const user = window.auth?.currentUser;
                    if (!user || user.isAnonymous) {
                         alertMessage("Authentication required to post an item.");
                         switchView('register');
                         return;
                    }
                    
                    const itemData = {
                        name: document.getElementById('item-title').value,
                        category: document.getElementById('item-category').value,
                        price: parseInt(document.getElementById('item-price').value),
                        description: document.getElementById('item-description').value,
                        listedBy: user.email || 'Verified User', // Use email for display if available
                        userId: user.uid,
                        image: 'https://placehold.co/400x300/4CAF50/fff?text=NEW+ITEM', // Placeholder image URL
                        timestamp: serverTimestamp(),
                    };
                    
                    if (!window.db) {
                        alertMessage("Database is not configured. Cannot save item.");
                        return;
                    }

                    try {
                        const listingsRef = collection(window.db, `artifacts/${window.appId}/public/data/listings`);
                        await callApiWithBackoff(() => addDoc(listingsRef, itemData));
                        
                        alertMessage("Success! Your item has been listed for campus peers.");
                        postItemForm.reset();
                        switchView('marketplace');
                    } catch (error) {
                        console.error("Post Item Error:", error);
                        alertMessage(`Failed to list item: ${error.message}`);
                    }
                });
            }

            if (contactForm) {
                contactForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    alertMessage("Thank you! Your message has been sent to the Grovance team (Simulated).");
                    contactForm.reset();
                });
            }
        }

        function alertMessage(message) {
            console.log("APP MESSAGE:", message);
            const oldModal = document.getElementById('app-message-modal');
            if (oldModal) oldModal.remove();

            const modal = document.createElement('div');
            modal.id = 'app-message-modal';
            modal.className = 'fixed top-4 right-4 bg-yellow-400 text-gray-800 p-4 rounded-xl shadow-xl transition-all duration-300 z-[100]';
            modal.textContent = message;
            document.body.appendChild(modal);

            setTimeout(() => {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.remove(), 300);
            }, 3000);
        }

        // --- 7. Initialization ---
        window.appLoaded = false;
        window.onload = () => {
             window.appLoaded = true;
             setupFormHandlers();
             
             if (searchInput) {
                 searchInput.addEventListener('input', () => filterProducts(currentCategory));
             }
             
             // Initial UI update and view switch
             if (window.isAuthReady) {
                 updateAuthUI(window.auth?.currentUser);
             }
             switchView('home'); 
        };
    </script>

</body>
</html>
